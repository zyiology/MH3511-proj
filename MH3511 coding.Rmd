---
title: "Untitled"
author: "Ancel Chong Fu Shea"
date: "3/16/2023"
output: html_document
---

## R Markdown

## Set up
```{r}
library(tidyverse)
library(readxl)
library(dplyr)
library(scales)
library(ggplot2)
library(lubridate)
library(gridExtra)
library(ncdf4)
library(tibbletime)

#change data path as necessary..
#path <- '/Users/nicholaschan/Documents/GitHub/MH3511-proj/data'
```

## Reading Data (what data is this)
```{r}

data <- read.csv('C:/Users/ancel/Downloads/historical-daily-weather-records.csv')

head(data)

data$date<-as.Date(data[,1])

monthly <- group_by(data,month = lubridate::floor_date(date, 'month')) 

```

## Reading SG Surface Air Temp data   
```{r}

sat <- read.csv('C:/Users/ancel/Downloads/surface-air-temperature-monthly-mean.csv')

sat[,1]<-as.Date(paste(sat[,1], "-01", sep=""))

#getting reference range..
sat.ref <- sat[sat$month >= as.Date('1980-01-01') & sat$month <= as.Date('2010-12-31'),]

#calculate avg temp/month in ref period to act as a baseline for anomalies..
sat.ref <- sapply(1:12, function(m){
  avg.temp <- round(mean(sat.ref[which(month(sat.ref$month)==m),]$mean_temp),4)
  
})
sat.new <- sat[sat$month >= as.Date('2011-01-01') & sat$month <= as.Date('2022-12-31'),]

#calculating sat anomalies from 2011 onwards..
sat.anom<- data.frame(month = sat.new$month,
                        anom = sapply(1:nrow(sat.new),function(i){
                        
                        #sat on a specific month - sat in ref period of the same month..
                        anomaly <- sat.new$mean_temp[i]-sat.ref[month(sat.new$month[i])]
                          
                        }))

ggplot(sat) + 
  geom_point(aes(x=month, y = mean_temp)) + 
  geom_line(aes(x=month, y = mean_temp))

```

## Reading monthly SG rainfall data
```{r}

#reading rainfall data..
rainf <- read.csv('C:/Users/ancel/Downloads/rainfall-monthly-total.csv')

rainf[,1]<-as.Date(paste(rainf[,1], "-01", sep=""))

#getting reference range for rainfall..
rainf.ref <- rainf[rainf$month >= as.Date('1980-01-01') & rainf$month <= as.Date('2010-12-31'),]

#calculate avg rainf/month in ref period to act as a baseline for anomalies..
rainf.ref <- sapply(1:12, function(m){
  avg.rainf <- round(mean(rainf.ref[which(month(rainf.ref$month)==m),]$total_rainfall),4)
})

#find rainfall data period of interest, 2011 onwards..
rainf.new <- rainf[rainf$month >= as.Date('2011-01-01') & 
                  rainf$month <= as.Date('2022-12-01'),]

#caluclating rainfall anomalies from 2011..
rainf.anom<- data.frame(month = rainf.new$month,
                        anom = sapply(1:nrow(rainf.new),function(i){
                        
                        #rainfall on a specific month - rainfall in ref period of the same month
                        anomaly <- rainf.new$total_rainfall[i]-rainf.ref[month(rainf.new$month[i])]
                          
                        }))

#plotting scatter and line plots
ggplot(rainf) + 
  geom_point(aes(x=month, y = total_rainfall)) + 
  geom_line(aes(x=month, y = total_rainfall))

```

## SST Summary Statistics for SST
```{r}

#read sst data
sst <- read.table('data/sstoi.indices.txt',header=T)

sst.n34 <- data.frame(month = as.Date(paste(sst$YR,sst$MON,'01',sep='-')),
                        sst = sst$NINO3.4)

sst.hist <- ggplot(data=sst.n34, aes(x=sst))+
  geom_histogram(color='black',bins=50)+
  xlab('SST')+
  ylab('Frequency')+
  ggtitle('Pacific monthly SST data from Jan 1982 to Feb 2023')
  
sst.hist #generally unimodal, normal dist.

boxplot(sst.N3.4$sst, 
        main = 'Pacific monthly SST data from Jan 1982 to Feb 2023',
        ylab = 'SST')

sst.ts <- ggplot(sst.n34, aes(x=month,y=sst))+
  geom_path()+
  ggtitle('Pacific monthly SST Time Series from 1982 to 2023')+
  xlab('Time')

sst.ts #data looks sound

```

## Finding SST Anomaly Data in the Pacific
```{r}
#finding ref range 1980-2010
sst.ref <- sst[sst$YR >= 1980 & sst$YR <= 2010,]

#sst baseline per month 
sst.ref <- sapply(1:12, function(m){
  avg.sst <- round(mean(sst.ref[which(month(sst.ref$MON)==m),]$NINO3.4),4)
})

#sst range for 2011 onwards, data that matters
sst.new<- sst[sst$YR >= 2011 & sst$YR <= 2022,]

# finding anomaly with fixed dates. assume data was with respect to first day of the month
# note the data has anomaly values bur wrt to 1990-2020.
sst.anom<- data.frame(month = as.Date(paste(sst.new$YR,sst.new$MON,'01',sep='-')),
                        anom = sapply(1:nrow(sst.new),function(i){
                        
                        #sst on a specific month - sst in ref period of the same month
                        anomaly <- sst.new$NINO3.4[i]-sst.ref[sst.new$MON[i]]
                          
                        }))

#remove duplicate data
dupes <- duplicated(sst.anom$month)
sst.anom <- subset(sst.anom,!dupes)
  
```

## Plotting scatter plots of SST with SG SAT and Rainfall
```{r}
df_plot <- data.frame(date = sst.anom$month,
                      sst_anom = sst.anom$anom,
                      sat_anom=sat.anom$anom,
                      rainf_anom=rainf.anom$anom)

#calculate correlation
sst.sat.corr <- cor(df_plot$sst_anom,df_plot$sat_anom)
sst.rainf.corr <- cor(df_plot$sst_anom,df_plot$rainf_anom)

df_corr <- data.frame(sst.sat.corr,sst.rainf.corr)

print(df_corr)

#scatter plots
ggplot(df_plot,aes(x=rainf_anom))+
  geom_point(aes(y=sst_anom,color='sst.rainf'))+
  scale_color_manual(values=c('sst.rainf'='pink'))+
  ggtitle('Monthly SG rainfall anomaly againt SST anomaly from Jan 2011- Feb 2023')

ggplot(df_plot,aes(x=sat_anom))+
  geom_point(aes(y=sst_anom,color='sst.sat'))+
  scale_color_manual(values=c('sst.sat'='lightblue'))+
  ggtitle('Monthly SG SST anomaly againt SST anomaly from Jan 2011- Feb 2023')

# timeshifting to find best correlation for sst & sg sat, consider only forward shift since we using pacific data to predict sg data
corr.ts.sat.sst <- sapply(1:12,function(i){
  
  ts.sst <- sst.anom[i:nrow(sst.anom),2]
  ts.sat <- sat.anom[1:(nrow(sst.anom)-i+1),2]
  cor.ts <- cor(ts.sst,ts.sat)
  month.cor <- c(i,cor.ts)
  return (month.cor)
})

corr.ts.sat.sst.df <- data.frame(month = corr.ts.sat.sst[1,],
                              corr.sst.sat = corr.ts.sat.sst[2,])

best.ts.sst.sat <- which.max(abs(corr.ts.sat.sst.df$corr.sst.sat))

# timeshifting to find best correlation for sst & sg rainf, consider only forward shift since we using pacific data to predict sg data
corr.ts.rainf.sst <- sapply(1:12,function(i){
  
  ts.sst <- sst.anom[i:nrow(sst.anom),2]
  ts.rainf <- rainf.anom[1:(nrow(rainf.anom)-i+1),2]
  cor.ts <- cor(ts.sst,ts.rainf)
  month.cor <- c(i,cor.ts)
  return (month.cor)
})

corr.ts.rainf.sst.df <- data.frame(month = corr.ts.rainf.sst[1,],
                              corr.sst.rainf = corr.ts.rainf.sst[2,])

best.ts.sst.rainf <- which.max(abs(corr.ts.rainf.sst.df$corr.sst.rainf))

```

## Reading Low level wind data

```{r read_wind_data eval=FALSE}

winddata = nc_open('data/wspd.mean.nc')


time = ncvar_get(winddata,"time") #data starts from 1800/01, end at 2023/01
startMonth = (1980-1800)*12+1 #1980/01
endMonth = (2011-1800)*12 #2010/12

lat = ncvar_get(winddata,'lat')
lon = ncvar_get(winddata,'lon')
latIndices = which(lat<=5 & lat>=-5)
lonIndices = which(lon<=240 & lon>=190)

windarray = ncvar_get(winddata, 'wspd')

#get the mean of the wind values within the nino3.4 region
ninoAreaMean = function(index) {
  windslice = windarray[,,index]
  ninoRegionData = windslice[lonIndices,latIndices]
  return(mean(ninoRegionData,na.rm=TRUE))
}

refPeriodValues = sapply(startMonth:endMonth, ninoAreaMean)

monthlyRefMeans = sapply(1:12,function(i) {
  monthValues = refPeriodValues[seq(i,length(refPeriodValues),12)]
  return(mean(monthValues))
})

#calculating anomaly
startMonth = (2011-1800)*12+1 #2011/01
endMonth = (2023-1800)*12 #2022/12
periodValues = sapply(startMonth:endMonth, ninoAreaMean)

periodAnomalies = periodValues - rep(monthlyRefMeans,(2023-2011))


#image(lon,rev(lat),a)
```

plotting wind anomaly against sg
```{r eval=FALSE}

cors = rep(0,11)
for (i in -10:0) {
  df_plot <- data.frame(windanomaly = periodAnomalies[1:(146+i)],
                        sat_anom = sat.anom$anom[(-i+1):146],
                        month = 1:(146+i))
  cors[i+11]=cor(df_plot$windanomaly,df_plot$sat_anom)
}

cors2 = rep(0,11)
for (i in 1:11) {
  df_plot <- data.frame(windanomaly = periodAnomalies[i:(145+i)],
                        sat_anom = sat.anom$anom[1:146],
                        month = 1:(146))
  cors2[i]=cor(df_plot$windanomaly,df_plot$sat_anom)
}

#scatter plots
# ggplot(df_plot,aes(x=month))+
#   geom_point(aes(y=windanomaly,color='sst.rainf'))+
#   scale_color_manual(values=c('sst.rainf'='pink'))+
#   ggtitle('Monthly SG rainfall anomaly againt SST anomaly from Jan 2011- Feb 2023')

ggplot(df_plot,aes(x=month))+
  geom_line(aes(y=sat_anom,color='sst.sat'))+
  geom_line(aes(y=windanomaly))+
  scale_color_manual(values=c('sst.sat'='lightblue'))+
  ggtitle('Monthly SG SST anomaly againt SST anomaly from Jan 2011- Feb 2023')

```


## Reading Sub Surface Temp data
```{r}

months <- 01:12

years <- 1980:2022

substemp.folder <- 'data/subsurfacetempfiles/'

substemp.file <- paste0(substemp.folder, 'EN.4.2.2.f.analysis.g10.')

#extracting subsurface data from netcdf files
substemp <- lapply(1:length(years),function(i){
  
  monthly <- lapply(1:length(months),function(k){
    
    if(months[k]<10){
      data <- nc_open(paste(substemp.file,years[i],'0',months[k],'.nc',sep=''))
    }
    else{
      data <- nc_open(paste(substemp.file,years[i],months[k],'.nc',sep=''))
    }

    
  })
  
})

#finding the mean temp at each month and each year
substemp.all <- sapply(1:length(substemp),function(j){
  
  monthly <- sapply(1:length(months),function(n){
    
    #finding all the temperature data
    data.temp <- (ncvar_get(substemp[[j]][[n]],'temperature'))
    
    #mean the monthly temp in the area of interest, lon 190-240 (-170,-120), lat 78-88 (-5,5)
    all.temp <- data.temp[190:240,78:88,]
    #temp <- data.temp[190:240,78:88,]
  
})
    
})

substemp.all.df <- data.frame(substemp = c(substemp.all))

substemp.all.df <- substemp.all.df - 273.15

substemp.hist <- ggplot(data=substemp.all.df, aes(x=substemp))+
  geom_histogram(color='black',bins=100)+
  xlab('Sub Surf Temp')+
  ylab('Frequency')+
  ggtitle('Pacific monthly Sub Surface Temp data from Jan 1980 to Feb 2023')
  
substemp.hist #generally unimodal, normal dist.

boxplot(substemp.all.df$substemp, 
        main = 'Pacific monthly Sub surface temp data from Jan 1980 to Feb 2023',
        ylab = 'Sub Surf Temp')


#finding the mean temp at each month and each year
substemp.mean <- sapply(1:length(substemp),function(j){
  
  monthly <- sapply(1:length(months),function(n){
    
    #finding all the temperature data
    data.temp <- (ncvar_get(substemp[[j]][[n]],'temperature'))
    
    #mean the monthly temp in the area of interest, lon 190-240 (-170,-120), lat 78-88 (-5,5)
    month.temp <- mean(data.temp[190:240,78:88,],na.rm=T)
    #temp <- data.temp[190:240,78:88,]
  
})
    
})

#convert celsius
substemp.mean <- substemp.mean-273.15

# start from 32 because that corresponds to 2011. Columns are years
substemp.anom <- sapply(32:ncol(substemp.mean),function(c){
  
  substemp.ref <- sapply(1:nrow(substemp.mean),function(r){
    
    #index 1:30 for the reference of 1980-2010.
    anom <- substemp.mean[r,c]-mean(substemp.mean[r,1:30])
    
  })
  
})

#turn matrix to vector for ease of access
substemp.anom.vec <- as.vector(substemp.anom)



```

## Correlate Sub Surface temp with SG Rainfall & SAT
```{r}
#set upper limit on data so reduce data length
df_plot2 <- data.frame(substemp_anom = substemp.anom.vec,
                      sat_anom=sat.anom[1:144,2],
                      rainf_anom=rainf.anom[1:144,2])

#calculate correlation
subs.sat.corr <- cor(df_plot2$substemp_anom,df_plot2$sat_anom)
subs.rainf.corr <- cor(df_plot2$substemp_anom,df_plot2$rainf_anom)

df_corr2 <- data.frame(subs.sat.corr,subs.rainf.corr)

print(df_corr2)

#scatter plots
ggplot(df_plot2,aes(x=rainf_anom))+
  geom_point(aes(y=substemp_anom,color='subs.rainf'))+
  scale_color_manual(values=c('subs.rainf'='pink'))+
  ggtitle('Monthly Sub Surf Temp anomaly againt SG Rainfall from Jan 2011- Dec 2022')

ggplot(df_plot2,aes(x=sat_anom))+
  geom_point(aes(y=substemp_anom,color='subs.sat'))+
  scale_color_manual(values=c('subs.sat'='lightblue'))+
  ggtitle('Monthly Sub Surf Temp anomaly againt SG SAT anomaly from Jan 2011- Dec 2022')

ggplot(df_plot2,aes(x=1:nrow(df_plot2)))+
  geom_line(aes(y=substemp_anom,color='subs'))+
  geom_line(aes(y=sat_anom,color='sat'))+
  #geom_line(aes(y=rainf_anom,color='rainf'))+
  scale_color_manual(values=c(subs='red',sat='lightgreen','rainf'='lightblue'))

# fakesat <- df_plot2$sat_anom[5:nrow(df_plot2)]
# fakesub <- df_plot2$substemp_anom[1:(nrow(df_plot2)-4)]
# 
# ggplot()+
#   geom_line(aes(x=1:140,y=fakesub,color='subs'))+
#   geom_line(aes(x=1:140,y=fakesat,color='sat'))+
#   scale_color_manual(values=c(subs='red',sat='lightgreen','rainf'='lightblue'))

# timeshifting to find best correlation for substemp & sg sat, consider only forward shift since we using pacific data to predict sg data
corr.ts.sat.substemp <- sapply(1:12,function(i){
  
  ts.substemp <- substemp.anom.vec[i:length(substemp.anom.vec)]
  ts.sat <- sat.anom[1:(nrow(sat.anom)-i+1),2]
  cor.ts <- cor(ts.substemp,ts.sat)
  month.cor <- c(i,cor.ts)
  return (month.cor)
})

corr.ts.sat.substemp.df <- data.frame(month = corr.ts.sat.substemp[1,],
                              corr.substemp.sat = corr.ts.sat.substemp[2,])

best.ts.substemp.sat <- which.max(abs(corr.ts.sat.substemp.df$corr.substemp.sat))

# timeshifting to find best correlation for substemp & sg rainf, consider only forward shift since we using pacific data to predict sg data
corr.ts.rainf.substemp <- sapply(1:12,function(i){
  
  ts.substemp <- substemp.anom.vec[i:length(substemp.anom.vec)]
  ts.rainf <- rainf.anom[1:(nrow(rainf.anom)-i+1),2]
  cor.ts <- cor(ts.substemp,ts.rainf)
  month.cor <- c(i,cor.ts)
  return (month.cor)
})

corr.ts.rainf.substemp.df <- data.frame(month = corr.ts.rainf.substemp[1,],
                              corr.substemp.rainf = corr.ts.rainf.substemp[2,])

best.ts.substemp.rainf <- which.max(abs(corr.ts.rainf.substemp.df$corr.substemp.rainf))
```

```{r}
nc_data <- nc_open("data/olr-monthly_v02r07_197901_202303.nc")

print (nc_data)

attributes(nc_data$var)

attributes(nc_data$dim)

lat <- ncvar_get(nc_data, "lat")

nlat <- dim(lat)

lon <- ncvar_get(nc_data, "lon")

nlon <- dim(lon)

time <- ncvar_get(nc_data, "time")

head(time) 
tunits <- ncatt_get(nc_data, "time", "units") 
nt <- dim(time) 

cloudiness <- ncvar_get(nc_data, "olr") 

fillvalue <- ncatt_get(nc_data, "olr", "_FillValue")

dim(cloudiness)

cloudiness[cloudiness==fillvalue$value] <- NA

# Convert the number of hours to POSIXct format, specifying the origin as "1800-01-01"
datetime <- as.Date(time, origin="1979-01-01")

lat_range <- c(-5, 5)
lon_range <- c(190, 240)

lat_idx <- which(lat >= lat_range[1] & lat <= lat_range[2])
lon_idx <- which(lon >= lon_range[1] & lon <= lon_range[2])

cloud_data <- cloudiness[lon_idx,lat_idx,]

lat_1 <- data.frame(t(cloud_data[1,,]), datetime)

ggplot(lat_1)+
  geom_point(aes(x=datetime, y=X1))+
  geom_line (aes(x=datetime, y=X1))

mean(cloudiness[1,1,])

pacific_avg <- sapply(1:531, function(a){
  year_avg <- mean(cloudiness[,,a])
})

lat <- data.frame(pacific_avg, datetime)

ggplot(lat)+
  geom_point(aes(x=datetime, y=pacific_avg))+
  geom_line (aes(x=datetime, y=pacific_avg))

```


```{r}

reference <- lat[13:384,]

test <- lat[385:528,]

jan_data <- data.frame()

feb_data <- data.frame()

mar_data <- data.frame()

apr_data <- data.frame()

may_data <- data.frame()

jun_data <- data.frame()

jul_data <- data.frame()

aug_data <- data.frame()

sep_data <- data.frame()

oct_data <- data.frame()

nov_data <- data.frame()

dec_data <- data.frame()

for (i in 1:nrow(reference)){
  
  if (month(reference[i,2])==1){
    
    jan_data[i,1:2]<-reference[i,] 
    
  }
  
  else if (month(reference[i,2])==2){
    
    feb_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==3){
    
    mar_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==4){
    
    apr_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==5){
    
    may_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==6){
    
    jun_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==7){
    
    jul_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==8){
    
    aug_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==9){
    
    sep_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==10){
    
    oct_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==11){
    
    nov_data[i,1:2]<-reference[i,]
    
  }
  
  else if (month(reference[i,2])==12){
    
    dec_data[i,1:2]<-reference[i,]
    
  }
  
  
}

jan_data <- na.omit(jan_data)
feb_data <- na.omit(feb_data)
mar_data <- na.omit(mar_data)
apr_data <- na.omit(apr_data)
may_data <- na.omit(may_data)
jun_data <- na.omit(jun_data)
jul_data <- na.omit(jul_data)
aug_data <- na.omit(aug_data)
sep_data <- na.omit(sep_data)
oct_data <- na.omit(oct_data)
nov_data <- na.omit(nov_data)
dec_data <- na.omit(dec_data)

jan_data_avg <- mean(jan_data[,1])
feb_data_avg <- mean(feb_data[,1])
mar_data_avg <- mean(mar_data[,1])
apr_data_avg <- mean(apr_data[,1])
may_data_avg <- mean(may_data[,1])
jun_data_avg <- mean(jun_data[,1])
jul_data_avg <- mean(jul_data[,1])
aug_data_avg <- mean(aug_data[,1])
sep_data_avg <- mean(sep_data[,1])
oct_data_avg <- mean(oct_data[,1])
nov_data_avg <- mean(nov_data[,1])
dec_data_avg <- mean(dec_data[,1])


```


```{r}

test_anomoly <- data.frame()

for (i in 1:nrow(test)){
  
    if (month(test[i,2])==1){
    
    test_anomoly[i,1]<-test[i,1]-jan_data_avg 
    
  }
  
  else if (month(test[i,2])==2){
    
    test_anomoly[i,1]<-test[i,1]-feb_data_avg 
    
  }
  
  else if (month(test[i,2])==3){
    
    test_anomoly[i,1]<-test[i,1]-mar_data_avg 
    
  }
  
  else if (month(test[i,2])==4){
    
    test_anomoly[i,1]<-test[i,1]-apr_data_avg 
    
  }
  
  else if (month(test[i,2])==5){
    
    test_anomoly[i,1]<-test[i,1]-may_data_avg 
    
  }
  
  else if (month(test[i,2])==6){
    
    test_anomoly[i,1]<-test[i,1]-jun_data_avg 
    
  }
  
  else if (month(test[i,2])==7){
    
    test_anomoly[i,1]<-test[i,1]-jul_data_avg 
    
  }
  
  else if (month(test[i,2])==8){
    
    test_anomoly[i,1]<-test[i,1]-aug_data_avg 
    
  }
  
  else if (month(test[i,2])==9){
    
    test_anomoly[i,1]<-test[i,1]-sep_data_avg 
    
  }
  
  else if (month(test[i,2])==10){
    
    test_anomoly[i,1]<-test[i,1]-oct_data_avg 
    
  }
  
  else if (month(test[i,2])==11){
    
    test_anomoly[i,1]<-test[i,1]-nov_data_avg 
    
  }
  
  else if (month(test[i,2])==12){
    
    test_anomoly[i,1]<-test[i,1]-dec_data_avg 
    
  }
  
  else{
    
    print('Error')
  }
  
}

```


Correlating cloudiness anomaly of 2011-2023 to Singapore anomaly (Rainfall and temprature)
```{r}

cor(rainf.anom[,2], test_anomoly[,1])

rainf.anom

cor(sat.anom[,2], test_anomoly[,1])

cors = rep(0,11)
for (i in -12:0) {
  df_plot <- data.frame(cloudanomaly = test_anomoly[1:(144+i),1],
                        sat_anom = sat.anom$anom[(-i+1):144])
  cors[i+11]=cor(as.numeric(df_plot$cloudanomaly),as.numeric(df_plot$sat_anom))
}

```

## All Data, Pairs Plot (Not Time Shifted)
```{r message=FALSE, warning=FALSE}
enso.df <- data.frame(month = sat.anom$month,
                      sat.sg=sat.anom$anom,
                      rainf.sg=rainf.anom$anom,
                      sst.pcf=sst.anom$anom,
                      substemp.pcf=substemp.anom.vec,
                      okla.pcf=test_anomoly$V1,
                      wind.pcf=periodAnomalies)

enso.df.nd <- enso.df[,2:ncol(enso.df)]

lowerFn <- function(data, mapping, method = "lm", ...) {
  p <- ggplot(data = data, mapping = mapping) +
    geom_point(colour = "black",size=0.3,alpha=0.5) +
    geom_smooth(method = method, color = "red", alpha=0.7,linewidth=0.5,...)
  p
}

ggpairs(enso.df.nd,columns = 1:ncol(enso.df.nd),
        upper = list(continuous = 'cor', combo = "box_no_facet"),
        lower = list(continuous = wrap(lowerFn, method='lm')),
        diag = list(continuous = wrap('barDiag',color='black',bins=25)),
        title='Distribution and Correlation of Predictor Variables')+
        theme(axis.text.x = element_text(angle=90),
              axis.text = element_text(size=7))

```


## Correlating cloudiness anomaly of 2011-2023 to Singapore anomaly (Rainfall and temeprature)
```{r}

cor(rainf.anom[,2], test_anomoly[1:146,1])

rainf.anom

cor(sat.anom[,2], test_anomoly[1:146,1])

cors = rep(0,11)
for (i in -12:0) {
  df_plot <- data.frame(cloudanomaly = test_anomoly[1:(146+i),1],
                        sat_anom = sat.anom$anom[(-i+1):146])
  cors[i+11]=cor(as.numeric(df_plot$cloudanomaly),as.numeric(df_plot$sat_anom))
}

cors2 = rep(0,11)
for (i in -12:0) {
  df_plot <- data.frame(cloudanomaly = test_anomoly[1:(146+i),1],
                        rain_anom = rainf.anom$anom[(-i+1):146])
  cors2[i+11]=cor(as.numeric(df_plot$cloudanomaly),as.numeric(df_plot$rain_anom))
}


```

