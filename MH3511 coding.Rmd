---
title: "Untitled"
author: "Ancel Chong Fu Shea"
date: "3/16/2023"
output: html_document
---

## R Markdown

## Set up
```{r}
library(tidyverse)
library(readxl)
library(dplyr)
library(scales)
library(ggplot2)
library(lubridate)

#change data path as necessary..
path <- '/Users/nicholaschan/Documents/GitHub/MH3511-proj/data'
```

## Reading Data (what data is this)
```{r}

setwd(path)

data <- read.csv('historical-daily-weather-records.csv')

head(data)

data$date<-as.Date(data[,1])

monthly <- group_by(data,month = lubridate::floor_date(date, 'month')) 

```

## Reading SG Surface Air Temp data
```{r}

setwd(path)

sat <- read.csv('surface-air-temperature-monthly-mean.csv')

sat[,1]<-as.Date(paste(sat[,1], "-01", sep=""))

#getting reference range..
sat.ref <- sat[sat$month >= as.Date('1980-01-01') & sat$month <= as.Date('2010-12-31'),]

#calculate avg temp/month in ref period to act as a baseline for anomalies..
sat.ref <- sapply(1:12, function(m){
  avg.temp <- round(mean(sat.ref[which(month(sat.ref$month)==m),]$mean_temp),4)
  
})
sat.new <- sat[sat$month >= as.Date('2011-01-01'),]

#calculating sat anomalies from 2011 onwards..
sat.anom<- data.frame(month = sat.new$month,
                        anom = sapply(1:nrow(sat.new),function(i){
                        
                        #sat on a specific month - sat in ref period of the same month..
                        anomaly <- sat.new$mean_temp[i]-sat.ref[month(sat.new$month[i])]
                          
                        }))

ggplot(sat) + 
  geom_point(aes(x=month, y = mean_temp)) + 
  geom_line(aes(x=month, y = mean_temp))

```

## Reading monthly SG rainfall data
```{r}
setwd(path)

#reading rainfall data..
rainf <- read.csv('rainfall-monthly-total.csv')

rainf[,1]<-as.Date(paste(rainf[,1], "-01", sep=""))

#getting reference range for rainfall..
rainf.ref <- rainf[rainf$month >= as.Date('1980-01-01') & rainf$month <= as.Date('2010-12-31'),]

#calculate avg rainf/month in ref period to act as a baseline for anomalies..
rainf.ref <- sapply(1:12, function(m){
  avg.rainf <- round(mean(rainf.ref[which(month(rainf.ref$month)==m),]$total_rainfall),4)
})

#find rainfall data period of interest, 2011 onwards..
rainf.new <- rainf[rainf$month >= as.Date('2011-01-01'),]

#caluclating rainfall anomalies from 2011..
rainf.anom<- data.frame(month = rainf.new$month,
                        anom = sapply(1:nrow(rainf.new),function(i){
                        
                        #rainfall on a specific month - rainfall in ref period of the same month
                        anomaly <- rainf.new$total_rainfall[i]-rainf.ref[month(rainf.new$month[i])]
                          
                        }))


#plotting scatter and line plots
ggplot(rainf) + 
  geom_point(aes(x=month, y = total_rainfall)) + 
  geom_line(aes(x=month, y = total_rainfall))

```

## Reading SST data in pacific..
```{r}
setwd(path)

sst <- read.table('sstoi.indices.txt',header=T)

```